<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ECtiers</title>
<style>
body { margin:0; font-family:sans-serif; background:#0b0c0f; color:#e6eef8; }
header { display:flex; justify-content:space-between; align-items:center; padding:12px 20px; background:#070708; border-bottom:1px solid rgba(255,255,255,0.03);}
.brand { font-weight:700; font-size:22px; }
.navtabs { display:flex; gap:6px; flex-wrap:wrap; margin-right:12px; }
.tab { padding:6px 12px; background:transparent; border-radius:8px; border:none; cursor:pointer; color:#98a2b3;}
.tab.active { background:rgba(255,255,255,0.03); color:#6ea0ff;}
.main { padding:16px; display:grid; grid-template-columns:1fr 280px; gap:12px; }
.panel { background:#0f1114; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.03); overflow:auto; max-height:calc(100vh - 60px);}
.tier-card { background:rgba(255,255,255,0.01); border-radius:12px; padding:12px; margin-bottom:12px; }
.tier-card h3 { margin:0 0 8px 0; font-size:16px; }
.player-entry { display:flex; justify-content:space-between; padding:6px 8px; border-radius:6px; background:rgba(255,255,255,0.02); margin-bottom:4px; font-size:14px; flex-direction:column;}
.player-entry span { font-size:12px; color:#98a2b3;}
#search-bar { display:flex; gap:6px; align-items:center; }
#search-bar input { padding:6px 8px; border-radius:6px; border:1px solid rgba(255,255,255,0.03); background:transparent; color:inherit;}
#search-bar button { padding:6px 12px; border-radius:6px; border:none; cursor:pointer; background:#3a7afe; color:white;}
.modal { position:fixed; inset:0; background:rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center;}
.modal-card { background:#0f1114; padding:16px; border-radius:12px; width:340px; border:1px solid rgba(255,255,255,0.03);}
.hide { display:none;}
</style>
</head>
<body>

<header>
  <div class="brand">MC-Tiers Tierlist</div>
  <div class="navtabs" id="gamemode-tabs"></div>
  <div id="search-bar">
    <input id="search-player" placeholder="Search Player">
    <button id="btn-search">Search</button>
    <button id="btn-admin-toggle" class="hide">Admin</button>
    <span id="who">Not logged in</span>
    <button id="btn-login">Log in</button>
    <button id="btn-logout" class="hide">Log out</button>
    <button id="btn-register">Register</button>
  </div>
</header>

<main class="main">
  <div class="panel" id="tierlist-panel"></div>
  <div class="panel" id="player-info-panel">
    <h3>Player Info</h3>
    <div id="player-info"></div>
  </div>
</main>

<!-- Login/Register Modal -->
<div class="modal hide" id="modal">
  <div class="modal-card">
    <h2 id="modal-title">Log In</h2>
    <input id="modal-user" placeholder="Username" style="width:100%; margin-bottom:6px;">
    <input id="modal-pass" type="password" placeholder="Password" style="width:100%; margin-bottom:6px;">
    <div style="margin-top:10px;">
      <button id="modal-ok">Submit</button>
      <button id="modal-cancel">Cancel</button>
    </div>
  </div>
</div>

<!-- Admin Modal -->
<div class="modal hide" id="admin-modal">
  <div class="modal-card">
    <h2>Admin Controls</h2>
    <input id="admin-player" placeholder="Player IGN" style="margin-bottom:4px; width:100%;">
    <select id="admin-gm" style="margin-bottom:4px; width:100%;"></select>
    <input id="admin-tier" placeholder="Tier (ht1, lt2, etc)" type="text" style="margin-bottom:4px; width:100%;">
    <input id="admin-points" placeholder="Points" type="number" style="margin-bottom:4px; width:100%;">
    <select id="admin-role" style="margin-bottom:4px; width:100%;">
      <option value="">--Change User Role--</option>
      <option value="user">User</option>
      <option value="admin">Admin</option>
      <option value="owner">Owner</option>
    </select>
    <div style="display:flex; gap:4px; margin-top:6px;">
      <button id="btn-admin-set">Set Points</button>
      <button id="btn-admin-remove">Remove Tier</button>
      <button id="btn-admin-role">Set Role</button>
      <button id="btn-admin-close">Close</button>
    </div>
  </div>
</div>

<script>
const TIER_POINTS = { lt5:10, ht5:20, lt4:30, ht4:40, lt3:50, ht3:60, lt2:70, ht2:80, lt1:90, ht1:100 };
const GAMEMODES = ["crystal","sword","axe","uhc","netherite_pot","diamond_pot","mace","smp","diamond_smp"];
const LOCAL_USERS_KEY = "mc_tiers_users";
const LOCAL_PLAYERS_KEY = "mc_tiers_players";

let users = JSON.parse(localStorage.getItem(LOCAL_USERS_KEY)) || {};
let players = JSON.parse(localStorage.getItem(LOCAL_PLAYERS_KEY)) || {};
let session = null;
let currentView = "overall";

const gamemodeTabs = document.getElementById("gamemode-tabs");
const tierlistPanel = document.getElementById("tierlist-panel");
const playerInfoPanel = document.getElementById("player-info");
const who = document.getElementById("who");

const modal = document.getElementById("modal");
const modalTitle = document.getElementById("modal-title");
const modalUser = document.getElementById("modal-user");
const modalPass = document.getElementById("modal-pass");

const adminModal = document.getElementById("admin-modal");
const adminPlayer = document.getElementById("admin-player");
const adminGM = document.getElementById("admin-gm");
const adminTier = document.getElementById("admin-tier");
const adminPoints = document.getElementById("admin-points");

// Tier colors
const TIER_COLORS = { 
  ht1:"#FFD700", lt1:"#FFD700",   // Gold
  ht2:"#C0C0C0", lt2:"#C0C0C0",   // Silver
  ht3:"#00FF00", lt3:"#00FF00",   // Green
  ht4:"#00FF00", lt4:"#00FF00",   // Green
  ht5:"#808080", lt5:"#808080"    // Gray
};

function saveUsers(){ localStorage.setItem(LOCAL_USERS_KEY, JSON.stringify(users)); }
function savePlayers(){ localStorage.setItem(LOCAL_PLAYERS_KEY, JSON.stringify(players)); }

// --- Setup gamemode tabs ---
const tabs = [];
function createTab(name){
  const btn = document.createElement("button"); btn.textContent = name==="overall"?"Overall":name; btn.className="tab";
  btn.onclick = ()=>{ currentView=name; tabs.forEach(t=>t.classList.remove("active")); btn.classList.add("active"); renderTierlist(); };
  gamemodeTabs.appendChild(btn); tabs.push(btn);
}
createTab("overall");
GAMEMODES.forEach(gm=>createTab(gm));

// --- Setup admin dropdown ---
GAMEMODES.forEach(gm=>{ const opt=document.createElement("option"); opt.value=gm; opt.textContent=gm; adminGM.appendChild(opt); });

// --- Login/Register ---
document.getElementById("btn-login").onclick = ()=>{ modalTitle.textContent="Log In"; modal.classList.remove("hide"); }
document.getElementById("btn-register").onclick = ()=>{ modalTitle.textContent="Register"; modal.classList.remove("hide"); }
document.getElementById("modal-cancel").onclick = ()=>modal.classList.add("hide");
document.getElementById("modal-ok").onclick = ()=>{
  const username = modalUser.value.trim();
  const password = modalPass.value;
  if(!username || !password) return alert("Enter username/password");
  if(modalTitle.textContent==="Register"){
    if(users[username]) return alert("User exists");
    users[username]={password,role:"user"}; saveUsers(); alert("Registered!"); modal.classList.add("hide");
  } else {
    if(!users[username] || users[username].password!==password) return alert("Invalid login");
    session = {...users[username], username}; who.textContent = username+" • "+session.role;
    document.getElementById("btn-admin-toggle").classList.toggle("hide", !(session.role==="owner"||session.role==="admin"));
    modal.classList.add("hide");
    renderTierlist();
  }
  modalUser.value=""; modalPass.value="";
};
document.getElementById("btn-logout").onclick = ()=>{ session=null; who.textContent="Not logged in"; document.getElementById("btn-admin-toggle").classList.add("hide"); renderTierlist(); };

// --- Admin Modal ---
document.getElementById("btn-admin-toggle").onclick = ()=> adminModal.classList.remove("hide");
document.getElementById("btn-admin-close").onclick = ()=> adminModal.classList.add("hide");

// Admin: Add/Set Points
document.getElementById("btn-admin-set").onclick = ()=>{
  if(!session || !(session.role==="owner"||session.role==="admin")) return alert("Only owner/admin");
  const ign=adminPlayer.value.trim(); const gm=adminGM.value; const tier=adminTier.value.trim(); const pts=parseInt(adminPoints.value);
  if(!ign || !tier || isNaN(pts)) return alert("Invalid input");
  if(!players[ign]) players[ign]={};
  if(!players[ign][gm]) players[ign][gm]=[];
  players[ign][gm].push({tier,points:pts});
  savePlayers(); alert("Points added!");
  adminPlayer.value=""; adminTier.value=""; adminPoints.value=""; renderTierlist();
};

// Admin: Remove Tier
document.getElementById("btn-admin-remove").onclick = ()=>{
  if(!session || !(session.role==="owner"||session.role==="admin")) return alert("Only owner/admin");
  const ign=adminPlayer.value.trim(); const gm=adminGM.value; const tier=adminTier.value.trim();
  if(!players[ign] || !players[ign][gm]) return alert("No such player/tier");
  const index = players[ign][gm].findIndex(e=>e.tier===tier);
  if(index===-1) return alert("Tier not found for this player in this gamemode");
  players[ign][gm].splice(index,1);
  savePlayers();
  alert(`Removed ${tier} from ${ign} in ${gm}`);
  adminPlayer.value=""; adminTier.value=""; renderTierlist();
};

// Admin: Change Role
document.getElementById("btn-admin-role").onclick = ()=>{
  if(!session || !(session.role==="owner"||session.role==="admin")) return alert("Only owner/admin");
  const username = adminPlayer.value.trim();
  const newRole = document.getElementById("admin-role").value;
  if(!users[username]) return alert("User does not exist");
  if(!newRole) return alert("Select role");
  users[username].role = newRole;
  saveUsers();
  alert(`${username} is now ${newRole}`);
};

// Search
document.getElementById("btn-search").onclick = ()=>{
  const ign= document.getElementById("search-player").value.trim();
  if(!ign){ playerInfoPanel.innerHTML=""; return;}
  if(!players[ign]) { playerInfoPanel.innerHTML="No data for "+ign; return; }
  let total=0; let tiers=[];
  GAMEMODES.forEach(gm=>{ const arr=players[ign][gm]||[]; arr.forEach(e=>{ total+=e.points; tiers.push(`${gm}: ${e.tier}`); }); });
  const sorted = Object.keys(players).map(p=>{ let t=0; GAMEMODES.forEach(gm=>{ const arr=players[p][gm]||[]; arr.forEach(e=>{t+=e.points}); }); return {p,t}; }).sort((a,b)=>b.t-a.t);
  let rank=sorted.findIndex(o=>o.p===ign)+1;
  playerInfoPanel.innerHTML=`<strong>${ign}</strong> — Rank #${rank}<br>Total Points: ${total}<br>Tiers: ${tiers.join(", ")}`;
};

// Render Tierlist
function renderTierlist(){
  tierlistPanel.innerHTML="";
  
  if(currentView==="overall"){
    const overallArr = [];
    for(const p in players){
        let total=0;
        const gmTiers=[];
        GAMEMODES.forEach(gm=>{
            const arr = players[p][gm]||[];
            let gmPts=0;
            let gmTier="None";
            if(arr.length>0){
                gmPts = arr.reduce((a,b)=>a+b.points,0);
                gmTier = arr[arr.length-1].tier;
            }
            total += gmPts;
            gmTiers.push({gm, tier:gmTier, points: gmPts});
        });
        overallArr.push({name:p,total,gmTiers});
    }
    overallArr.sort((a,b)=>b.total-a.total);

    overallArr.forEach(p=>{
        const card = document.createElement("div"); 
        card.className="tier-card";
        const title = document.createElement("div");
        title.innerHTML=`<strong>${p.name}</strong> — ${p.total} pts`;
        card.appendChild(title);

        const table = document.createElement("div");
        table.style.display="grid";
        table.style.gridTemplateColumns="120px 60px 50px";
        table.style.rowGap="4px";
        table.style.marginTop="6px";

        p.gmTiers.forEach(gm=>{
            const gmName = document.createElement("div"); 
            gmName.textContent = gm.gm.charAt(0).toUpperCase()+gm.gm.slice(1).replace("_"," "); 
            const tierSpan = document.createElement("div");
            tierSpan.textContent = gm.tier.toUpperCase();
            tierSpan.style.background=TIER_COLORS[gm.tier]||"#333";
            tierSpan.style.padding="2px 6px";
            tierSpan.style.borderRadius="6px";
            tierSpan.style.textAlign="center";
            const pointsDiv = document.createElement("div");
            pointsDiv.textContent = gm.points;
            table.appendChild(gmName);
            table.appendChild(tierSpan);
            table.appendChild(pointsDiv);
        });

        card.appendChild(table);
        tierlistPanel.appendChild(card);
    });
  } else {
    const gm = currentView;
    const card=document.createElement("div"); card.className="tier-card";
    const h3=document.createElement("h3"); h3.textContent=gm.replace("_"," "); card.appendChild(h3);
    for(const p in players){
        const arr = players[p][gm]||[];
        arr.forEach(e=>{
            const pe = document.createElement("div"); pe.className="player-entry";
            pe.innerHTML = `${p} <span>${e.tier}</span> — ${e.points} pts`;
            pe.style.borderLeft = `4px solid ${TIER_COLORS[e.tier]||"#333"}`;
            card.appendChild(pe);
        });
    }
    tierlistPanel.appendChild(card);
  }
}

// --- Demo owner account ---
if(!users["sussytech"]){ users["sussytech"]={password:"Sussybaka1!2@3#4$",role:"owner"}; saveUsers(); }

renderTierlist();
</script>

</body>
</html>
