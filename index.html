<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MC-Tiers Points System</title>
<style>
body { margin:0; font-family:sans-serif; background:#0b0c0f; color:#e6eef8; }
header { display:flex; justify-content:space-between; align-items:center; padding:12px 20px; background:#070708; border-bottom:1px solid rgba(255,255,255,0.03);}
.brand { font-weight:700; font-size:22px; }
.main { padding:16px; display:flex; flex-direction:column; gap:12px; }
.panel { background:#0f1114; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.03); }
input, select, button { margin-bottom:8px; padding:8px; border-radius:6px; border:1px solid rgba(255,255,255,0.03); background:transparent; color:inherit;}
button { cursor:pointer; background:#3a7afe; color:white; border:none; }
.player-info { margin-top:8px; padding:8px; border-radius:8px; background:rgba(255,255,255,0.02);}
.hide { display:none;}
</style>
</head>
<body>

<header>
  <div class="brand">MC-Tiers Points System</div>
  <div>
    <span id="who">Not logged in</span>
    <button id="btn-login">Log in</button>
    <button id="btn-logout" class="hide">Log out</button>
    <button id="btn-register">Register</button>
  </div>
</header>

<main class="main">
  <div class="panel" id="admin-panel" class="hide">
    <h3>Admin / Owner Controls</h3>
    <input id="admin-player" placeholder="Player IGN">
    <select id="admin-gm"></select>
    <input id="admin-points" placeholder="Points" type="number">
    <button id="btn-setpoints">Set Points</button>
  </div>

  <div class="panel">
    <h3>Search Player</h3>
    <input id="search-player" placeholder="Enter IGN">
    <button id="btn-search">Search</button>
    <div id="player-info" class="player-info hide"></div>
  </div>
</main>

<div class="modal hide" id="modal">
  <div class="panel">
    <h3 id="modal-title">Log In</h3>
    <input id="modal-user" placeholder="Username">
    <input id="modal-pass" type="password" placeholder="Password">
    <div>
      <button id="modal-ok">Submit</button>
      <button id="modal-cancel">Cancel</button>
    </div>
  </div>
</div>

<script>
const GAMEMODES = ["crystal","sword","axe","uhc","netherite_pot","diamond_pot","mace","smp","diamond_smp"];
const LOCAL_USERS_KEY = "mc_tiers_users";
const LOCAL_PLAYERS_KEY = "mc_tiers_players";

let users = JSON.parse(localStorage.getItem(LOCAL_USERS_KEY)) || {};
let players = JSON.parse(localStorage.getItem(LOCAL_PLAYERS_KEY)) || {};
let session = null;

const who = document.getElementById("who");
const modal = document.getElementById("modal");
const modalTitle = document.getElementById("modal-title");
const modalUser = document.getElementById("modal-user");
const modalPass = document.getElementById("modal-pass");

const adminPanel = document.getElementById("admin-panel");
const adminPlayer = document.getElementById("admin-player");
const adminGM = document.getElementById("admin-gm");
const adminPoints = document.getElementById("admin-points");
const btnSetPoints = document.getElementById("btn-setpoints");

const searchInput = document.getElementById("search-player");
const btnSearch = document.getElementById("btn-search");
const playerInfo = document.getElementById("player-info");

function saveUsers(){ localStorage.setItem(LOCAL_USERS_KEY, JSON.stringify(users)); }
function savePlayers(){ localStorage.setItem(LOCAL_PLAYERS_KEY, JSON.stringify(players)); }

// --- Setup gamemode dropdown ---
GAMEMODES.forEach(gm=>{
  const opt=document.createElement("option"); opt.value=gm; opt.textContent=gm; adminGM.appendChild(opt);
});

// --- Modal login/register ---
document.getElementById("btn-login").onclick = ()=>{
  modalTitle.textContent="Log In";
  modal.classList.remove("hide");
};
document.getElementById("btn-register").onclick = ()=>{
  modalTitle.textContent="Register";
  modal.classList.remove("hide");
};
document.getElementById("modal-cancel").onclick = ()=>modal.classList.add("hide");

document.getElementById("modal-ok").onclick = ()=>{
  const username = modalUser.value.trim();
  const password = modalPass.value;
  if(!username || !password) { alert("Enter username and password"); return; }

  if(modalTitle.textContent==="Register"){
    if(users[username]) { alert("User exists"); return; }
    users[username]={password,role:"user"};
    saveUsers();
    alert("Registered successfully. Now login.");
  } else {
    if(!users[username] || users[username].password!==password) { alert("Invalid login"); return; }
    session = users[username]; session.username=username;
    who.textContent=username+" • "+session.role;
    if(session.role==="owner" || session.role==="admin"){ adminPanel.classList.remove("hide"); } else { adminPanel.classList.add("hide"); }
    modal.classList.add("hide");
  }
  modalUser.value=""; modalPass.value="";
};

document.getElementById("btn-logout").onclick = ()=>{
  session=null;
  who.textContent="Not logged in";
  adminPanel.classList.add("hide");
};

// --- Admin set points ---
btnSetPoints.onclick = ()=>{
  if(!session || (session.role!=="owner" && session.role!=="admin")) { alert("Only owner/admin"); return; }
  const ign = adminPlayer.value.trim();
  const gm = adminGM.value;
  const pts = parseInt(adminPoints.value);
  if(!ign || isNaN(pts)) { alert("Invalid input"); return; }
  if(!players[ign]) players[ign]={};
  players[ign][gm]=pts;
  savePlayers();
  alert("Points set!");
  adminPlayer.value=""; adminPoints.value="";
};

// --- Search player ---
btnSearch.onclick = ()=>{
  const ign = searchInput.value.trim();
  if(!ign){ alert("Enter IGN"); return; }
  if(!players[ign]) { playerInfo.textContent="No data for player "+ign; playerInfo.classList.remove("hide"); return; }
  let total=0; let tiers=[];
  for(const gm of GAMEMODES){ const pts = players[ign][gm]||0; if(pts>0){ total+=pts; tiers.push(gm+"("+pts+")"); } }
  // Calculate rank
  const sorted = Object.keys(players).map(p=>{ let t=0; GAMEMODES.forEach(gm=>{ t+=players[p][gm]||0; }); return {p,t}; }).sort((a,b)=>b.t-a.t);
  let rank = sorted.findIndex(o=>o.p===ign)+1;
  playerInfo.innerHTML=`<strong>${ign}</strong> — Rank #${rank}<br>Total Points: ${total}<br>Gamemodes: ${tiers.join(", ")}`;
  playerInfo.classList.remove("hide");
};

// --- Demo owner account ---
if(!users["sussytech"]){ users["sussytech"]={password:"Sussybaka1!2@3#4$",role:"owner"}; saveUsers(); }
</script>

</body>
</html>
